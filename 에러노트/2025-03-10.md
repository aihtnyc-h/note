
### **에러노트: 데이터 테이블에서 열 숨기기 및 엑셀 다운로드 후 숨김 처리**

---

#### **문제 설명:**

- 데이터 테이블에서 특정 열을 **숨기기** 위해 `columnDefs`를 사용하여 `visible: false`로 설정하였으나, **엑셀 다운로드 시 숨겨진 열**이 **헤더와 함께 숨겨지지 않도록** 하기 위한 문제에 직면했습니다.
- 엑셀 파일 다운로드 후 **숨겨진 열을 다시 표시**하고, 다운로드가 끝난 후 다시 **숨기기** 위한 방법을 구현하려고 했습니다.

#### **문제 발생 원인:**

1. **엑셀 다운로드 시 숨겨진 열도 포함됨**:
    
    - DataTable에서 열을 숨기면 그 열은 화면에서 보이지 않지만, **엑셀 다운로드 시 숨겨진 열이 여전히 데이터에 포함**됩니다. 이는 DataTables의 **Excel export** 기능이 **화면에 표시되지 않는 열도 엑셀 파일에 포함**시키기 때문입니다.
2. **숨긴 열을 엑셀 다운로드 후 다시 숨기기**:
    
    - 엑셀 파일을 다운로드한 후 **숨겨진 열을 다시 숨기기** 위한 설정이 필요했습니다. 하지만 이를 위해서는 **열의 표시 여부를 다시 설정**해야 하며, 일부 경우에 이 설정이 제대로 적용되지 않거나 **타이밍 문제**가 발생할 수 있습니다.

---

#### **해결 방안:**

1. **엑셀 다운로드 시 숨겨진 열 다시 표시**:
    
    - 엑셀 다운로드 시 숨겨진 열을 다시 표시하기 위해, `table.columns([7, 8, 9, 13, 14, 15, 16, 19, 20, 21, 22, 23, 24, 25, 26]).visible(true);`를 사용하여 해당 열들을 **강제로 표시**해야 합니다.
2. **다운로드 후 열 숨기기**:
    
    - 엑셀 다운로드 후 1초 뒤에 숨겨진 열을 다시 숨기기 위해 `setTimeout`을 사용하여 **지연**을 두고 숨김 처리를 적용했습니다. 이렇게 하면 **엑셀 다운로드가 완료된 후**에 숨겨진 열을 다시 숨길 수 있습니다.

---

#### **구현 코드:**

1. **열 숨기기 설정 (초기화)**:
```js
// 열을 숨기기 위한 columnDefs 추가 
"columnDefs": [     
	{         
	"targets": [7, 8, 9, 13, 14, 15, 16, 19, 20, 21, 22, 23, 24, 25, 26], 
	// 인덱스를 직접 지정         
	"visible": false // 해당 열을 숨깁니다.     
	} 
],
```


2. **엑셀 다운로드 시 숨겨진 열 다시 표시**:

```js
// 엑셀 다운로드 시 숨겨진 열을 다시 표시 
table.columns([7, 8, 9, 13, 14, 15, 16, 19, 20, 21, 22, 23, 24, 25, 26])
.visible(true); // 숨겨진 열 표시
```


3. **다운로드 후 숨겨진 열 다시 숨기기 (1초 지연)**:

```js
// 다운로드 후 숨겨진 열 다시 숨기기 
setTimeout(function() {     table.columns([7, 8, 9, 13, 14, 15, 16, 19, 20, 21, 22, 23, 24, 25, 26])
.visible(false); // 열 다시 숨기기 
}, 1000); // 다운로드 후 1초 뒤에 숨기기
```

---

#### **에러 해결 과정:**

1. **엑셀 다운로드 시 숨겨진 열 문제**:
    - **엑셀 다운로드 후 숨겨진 열**도 엑셀에 포함되지 않도록 하는 설정을 `visible(true)`를 사용하여 다운로드 전 해당 열을 다시 표시했습니다.
2. **다운로드 후 숨기기**:
    - 다운로드가 완료된 후, **setTimeout**을 사용하여 **1초 지연 후 숨기기** 작업을 실행하여 사용자가 엑셀을 다운로드한 후 다시 열을 숨길 수 있도록 했습니다.

---

#### **주요 고려사항:**

- **타이밍 문제**:
    - `setTimeout`을 사용하여 1초 후에 열을 숨기도록 설정했지만, 이 값은 다운로드 속도에 따라 조정될 수 있습니다. 실제 다운로드 시간이 더 길 경우, **1초의 지연 시간**이 충분하지 않을 수 있으므로, 필요에 따라 **지연 시간을 조정**해야 할 수도 있습니다.
- **성능 고려**:
    - `setTimeout`을 사용하여 지연을 주는 방식은 간단하지만, 엑셀 다운로드 및 열 숨김/표시 작업이 **실시간으로 처리되는 경우**, 이 방법이 성능에 영향을 미칠 수 있으므로, **다른 방법으로 이벤트 리스너를 활용한 방법**도 고려할 수 있습니다.

---

#### **결론:**

엑셀 다운로드 시 숨겨진 열을 다시 표시하고, 다운로드 후 숨겨진 열을 다시 숨기기 위한 방법을 구현했습니다. 이 방식은 `columnDefs`로 열을 숨기고, 엑셀 다운로드 전에 열을 **강제로 표시**한 후, **다운로드가 끝난 뒤**에 숨기는 방식으로 해결되었습니다.