### **에러노트: 대용량 엑셀 다운로드 성능 개선 - `SXSSFWorkbook`의 `rowAccessWindowSize` 설정 관련**

---

#### **문제 설명:**

대용량 엑셀 파일을 생성할 때, `SXSSFWorkbook`을 사용하여 메모리 효율을 개선하고 성능을 최적화하는 방법으로 `rowAccessWindowSize`를 설정할 수 있습니다. 그러나 이 값을 너무 크게 설정하면 성능 저하나 메모리 부족 문제가 발생할 수 있습니다.

#### **문제 발생 원인:**

1. **`rowAccessWindowSize` 값 과다 설정**:
    
    - `rowAccessWindowSize`는 한 번에 메모리에서 처리할 행(row)의 수를 설정합니다. 값을 지나치게 크게 설정하면 메모리 사용량이 급격히 증가하고, 디스크와의 I/O 성능 저하를 초래할 수 있습니다.
    - 시스템 메모리가 충분하지 않으면 과도한 메모리 사용으로 인해 `OutOfMemoryError`가 발생할 수 있습니다.
2. **메모리 부족 및 성능 저하**:
    
    - 메모리 사용량이 과다해지면, 특히 서버에서 대용량 데이터를 처리할 경우, 성능 저하가 심각할 수 있습니다. 디스크로 데이터를 쓰는 과정에서 I/O 병목이 발생할 수 있습니다.
3. **성능 최적화에 실패**:
    
    - 최적의 `rowAccessWindowSize` 값은 시스템의 메모리 용량과 사용 환경에 따라 달라지기 때문에, 적절한 실험과 측정 없이 설정된 값이 오히려 성능을 저하시킬 수 있습니다.

---

#### **해결 방안:**

1. **`rowAccessWindowSize` 값 적절히 설정**:
    
    - **일반적으로 추천되는 값**은 `2000`에서 `5000` 정도입니다. 이 값은 대부분의 시스템에서 안정적으로 성능을 유지할 수 있습니다.
    - **10000**으로 설정하면 일부 시스템에서는 성능 개선을 경험할 수 있지만, 메모리 부족 또는 디스크 I/O 병목 현상이 발생할 수 있으므로 **실험을 통한 최적값을 찾는 것이 중요**합니다.
2. **메모리 사용량과 성능 테스트**:
    
    - 설정을 변경할 때, 메모리 사용량과 성능을 측정하여 최적의 값을 찾아야 합니다. 시스템의 메모리 용량, CPU 성능, 디스크 속도 등에 따라 적정 값을 실험적으로 결정하는 것이 중요합니다.
3. **성능 모니터링 도구 사용**:
    
    - **JVM 모니터링 도구** (예: JVisualVM, JProfiler 등)를 사용하여 메모리 사용량과 I/O 성능을 실시간으로 모니터링하고, `rowAccessWindowSize` 설정을 조정할 때의 영향을 관찰해야 합니다.

---

#### **실험을 통한 최적 값 찾기:**

1. **`rowAccessWindowSize` 설정 실험**:
    
```js
SXSSFWorkbook wb = new SXSSFWorkbook(100);  // 기본 설정 (100) 
// rowAccessWindowSize를 2000으로 설정해 보기 
SXSSFWorkbook wb2 = new SXSSFWorkbook(2000); 
// rowAccessWindowSize를 5000으로 설정해 보기 
SXSSFWorkbook wb3 = new SXSSFWorkbook(5000); 
```

    
    - 각 설정 값에 대해 엑셀 파일을 생성하고, 메모리 사용량, 파일 크기, 생성 시간을 측정합니다.
    - 결과를 비교하여 최적의 `rowAccessWindowSize` 값을 결정합니다.
2. **메모리 관리 및 I/O 최적화**:
    
    - 메모리 제한이 있을 경우, `SXSSFWorkbook`의 사용을 **한 번에 처리하는 데이터의 양**을 적절히 조정하여 메모리 부담을 줄여야 합니다.
    - 또한 **배치 처리(batch processing)**를 도입해 한 번에 처리하는 데이터를 나누어 I/O 성능을 최적화할 수 있습니다.

---

#### **에러 발생 시 점검 사항:**

1. **`OutOfMemoryError` 발생 여부**:
    
    - `rowAccessWindowSize` 값을 너무 크게 설정한 경우, 메모리 부족으로 **`OutOfMemoryError`**가 발생할 수 있습니다.
    - 이때, 메모리 부족을 피하려면 `rowAccessWindowSize` 값을 적절히 낮추거나 시스템 메모리를 확장해야 할 수 있습니다.
2. **파일 크기 및 생성 시간 확인**:
    
    - **파일 크기**가 너무 커지거나 **파일 생성 시간이 지나치게 길어지면** I/O 성능 문제나 메모리 문제로 인해 성능이 저하될 수 있습니다.
3. **JVM 힙 메모리 설정 확인**:
    
    - JVM의 힙 메모리 설정(`-Xmx`)이 충분한지 확인하고, 부족하다면 힙 메모리 크기를 늘려서 안정적인 메모리 할당을 지원해야 합니다.

---

#### **결론:**

- `SXSSFWorkbook`에서 `rowAccessWindowSize`를 조정하면 대용량 엑셀 파일 생성 시 성능을 개선할 수 있지만, 너무 큰 값을 설정하면 **메모리 부족**이나 **I/O 병목 현상**이 발생할 수 있습니다.
- **적절한 값 설정**을 위해서는 실험을 통해 최적의 값을 찾는 것이 중요합니다. 일반적으로 **2000~5000** 사이의 값이 대부분의 환경에서 적합하며, 성능 측정을 통해 적정 범위를 결정해야 합니다.
- **메모리 사용량**과 **I/O 성능**을 모니터링하여 최적의 설정을 찾는 것이 대용량 엑셀 다운로드 성능을 개선하는 핵심입니다.