- 삼진여객 충전이력 DB 
  스케줄러를 사용하여 1시간마다 충전이력 조회 후 DB에 적재 
	- 기존 쿼리 수정 (완료)
	- 데이터 등록 되어 있지 않아 다른 부분 확인 어려움
- 모바일 사용자 관리 리스트 포인트 추가 (완료)
- 모바일 사용자 관리 상세조회 포인트 부분 화면단 추가
  추후 기획안 완성 시 상세조회 포인트 적립 및 사용 기능 추가 예정 
- 품질 검사이력 DB 설계 및 DB 적재 API 개발
  -  DB 설계 (완료)
  -  API 컨트롤러 (완료)

![[Pasted image 20241119164642.png]]




----
에러노트
```
2024-11-19 11:14:12.096 ERROR 30632 --- [nio-9090-exec-8] o.a.c.c.C.[.[.[/].[dispatcherServlet]    : Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed; nested exception is org.springframework.dao.InvalidDataAccessApiUsageException: org.hibernate.hql.internal.ast.QuerySyntaxException: unexpected token: with near line 2, column 51 [select count(mobilePoint)
from com.moderntec.mog.vo.MobilePoint mobilePoint with mobileUsers.tokenId = mobilePoint.tokenId, com.moderntec.mog.vo.MobileUsers mobileUsers]; nested exception is java.lang.IllegalArgumentException: org.hibernate.hql.internal.ast.QuerySyntaxException: unexpected token: with near line 2, column 51 [select count(mobilePoint)
```


jpa **QueryDSL** 사용 시 구조 실수..!


기존 코드
```
JPAQuery<Tuple> jpaQuery = queryFactory  
    .select(userInfo, userPoint.point)  
    .join(userPoint).on(userInfo.tokenId.eq(userPoint.tokenId))
    .from(userInfo);
```

수정 코드
```
JPAQuery<Tuple> jpaQuery = queryFactory  
    .select(userInfo, userPoint.point)  
    .from(userInfo)  
    .join(userPoint).on(userInfo.tokenId.eq(userPoint.tokenId));
```


----

에러노트

포인트가 없을 경우 null 포인트 에러 발생
기존 코드
```
return new PageImpl<>(list.getResults().stream()  
        .map(tuple -> {  
            MobileUsers data = tuple.get(userInfo);  
            MobilePoint point = tuple.get(userPoint);  
            return new MobileUserDTO.UserListData(  
				point.getPoint() 
            );  
        })  
        .collect(Collectors.toList()), pageable, list.getTotal());
```


수정 코드
```
return new PageImpl<>(list.getResults().stream()  
        .map(tuple -> {  
	        MobileUsers data = tuple.get(userInfo);  
            MobilePoint point = tuple.get(userPoint);  
            return new MobileUserDTO.UserListData(  
            point != null && point.getPoint() != null ? point.getPoint() : 0  
            // point가 null일 경우 0 반환  
            );  
        })  
        .collect(Collectors.toList()), pageable, list.getTotal());
```


----

